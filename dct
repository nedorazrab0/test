#!/usr/bin/env bash
#
#
set -e

pacman -Sy archiso --noconfirm --disable-sandbox

conf=/baseline
cp -r "/usr/share/archiso/configs/${conf}" .
date="$(date '+%d%m%y')"
cat << 'EOF' > "${conf}/profiledef.sh"
iso_name='archiso'
iso_label="NAME"
iso_publisher='Arch Linux <https://archlinux.org>'
iso_application='Arch Linux baseline'
iso_version='v'
install_dir='arch'
buildmodes=('iso')
bootmodes=('uefi-x64.systemd-boot.esp')
arch='x86_64'
pacman_conf="pacman.conf"
airootfs_image_type='erofs'
#'-zlzma,level=109,dictsize=8388608'
airootfs_image_tool_options=(
  '-Eforce-inode-compact,ztailpacking'
  '-C512'
  '--workers=4'
)
#bootstrap_tarball_compression=('zstd' '-T0' '--ultra' '-20zc')
bootstrap_tarball_compression=('cat')
EOF

echo '- Building archiso...'
mkarchiso -vw ./hui "${conf}" 2>&1 > HUU
openssl sha256 HUU
cat HUU | wc -l
cat HUU