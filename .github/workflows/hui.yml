name: rls
on: workflow_dispatch
permissions:
  contents: write

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Installing `libarchive-tools`
        run: |
          sudo apt-get update
          sudo apt-get install libarchive-tools

      - name: Compressing
        run: |
          bsdtar --exclude=./README.md -b1 -cv ./* \
              | zstd -T0 --ultra -20zvc > ./njki

      - name: Releasing
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          sha="$(openssl sha256 ./njki | cut -d ' ' -f2)"
          shapart="${sha:1:2}-${sha:3:5}-${sha:6:8}-
                   -${sha:9:10}-${sha:11:13}-${sha:14:16}"

          gh release delete rolling --cleanup-tag -y || true
          echo -e "SHA256 Part:\n\`${shapart}\`" \
              | gh release create rolling ./njki -F-
